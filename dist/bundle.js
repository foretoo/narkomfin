import{EventDispatcher as Ct,Vector3 as O,MOUSE as J,TOUCH as $,Quaternion as he,Spherical as Ye,Vector2 as I,Scene as Ft,PerspectiveCamera as ot,WebGLRenderer as Ht,sRGBEncoding as te,ACESFilmicToneMapping as Ut,TrianglesDrawMode as jt,TriangleFanDrawMode as _e,TriangleStripDrawMode as rt,Loader as it,LoaderUtils as Me,FileLoader as pe,Color as X,SpotLight as Gt,PointLight as vt,DirectionalLight as at,MeshBasicMaterial as ae,MeshPhysicalMaterial as W,Matrix4 as me,InstancedMesh as Kt,Object3D as ct,TextureLoader as Bt,ImageBitmapLoader as Vt,BufferAttribute as ce,InterleavedBuffer as zt,InterleavedBufferAttribute as Xt,LinearFilter as lt,LinearMipmapLinearFilter as ut,RepeatWrapping as Se,PointsMaterial as Yt,Material as be,LineBasicMaterial as qt,MeshStandardMaterial as B,DoubleSide as dt,PropertyBinding as Wt,BufferGeometry as ft,SkinnedMesh as Zt,Mesh as ht,LineSegments as Qt,Line as Jt,LineLoop as $t,Points as en,Group as fe,MathUtils as tn,OrthographicCamera as nn,Skeleton as sn,InterpolateLinear as pt,AnimationClip as on,Bone as rn,NearestFilter as an,NearestMipmapNearestFilter as cn,LinearMipmapNearestFilter as ln,NearestMipmapLinearFilter as un,ClampToEdgeWrapping as dn,MirroredRepeatWrapping as fn,InterpolateDiscrete as hn,FrontSide as pn,Texture as qe,VectorKeyframeTrack as mn,QuaternionKeyframeTrack as We,NumberKeyframeTrack as gn,Box3 as Tn,Sphere as yn,Interpolant as En,LoadingManager as bn,Camera as An,PCFSoftShadowMap as Rn,HemisphereLight as wn}from"https://cdnjs.cloudflare.com/ajax/libs/three.js/0.149.0/three.module.min.js";const Ze={type:"change"},Ae={type:"start"},Qe={type:"end"};class Ln extends Ct{constructor(t,n){super(),this.object=t,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new O,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:J.ROTATE,MIDDLE:J.DOLLY,RIGHT:J.PAN},this.touches={ONE:$.ROTATE,TWO:$.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(u){u.addEventListener("keydown",Ke),this._domElementKeyEvents=u},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(Ze),e.update(),o=s.NONE},this.update=function(){const u=new O,y=new he().setFromUnitVectors(t.up,new O(0,1,0)),x=y.clone().invert(),M=new O,F=new he,Q=2*Math.PI;return function(){const Xe=e.object.position;u.copy(Xe).sub(e.target),u.applyQuaternion(y),a.setFromVector3(u),e.autoRotate&&o===s.NONE&&D(N()),e.enableDamping?(a.theta+=i.theta*e.dampingFactor,a.phi+=i.phi*e.dampingFactor):(a.theta+=i.theta,a.phi+=i.phi);let j=e.minAzimuthAngle,G=e.maxAzimuthAngle;return isFinite(j)&&isFinite(G)&&(j<-Math.PI?j+=Q:j>Math.PI&&(j-=Q),G<-Math.PI?G+=Q:G>Math.PI&&(G-=Q),j<=G?a.theta=Math.max(j,Math.min(G,a.theta)):a.theta=a.theta>(j+G)/2?Math.max(j,a.theta):Math.min(G,a.theta)),a.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(e.minDistance,Math.min(e.maxDistance,a.radius)),e.enableDamping===!0?e.target.addScaledVector(f,e.dampingFactor):e.target.add(f),u.setFromSpherical(a),u.applyQuaternion(x),Xe.copy(e.target).add(u),e.object.lookAt(e.target),e.enableDamping===!0?(i.theta*=1-e.dampingFactor,i.phi*=1-e.dampingFactor,f.multiplyScalar(1-e.dampingFactor)):(i.set(0,0,0),f.set(0,0,0)),c=1,l||M.distanceToSquared(e.object.position)>r||8*(1-F.dot(e.object.quaternion))>r?(e.dispatchEvent(Ze),M.copy(e.object.position),F.copy(e.object.quaternion),l=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",Be),e.domElement.removeEventListener("pointerdown",je),e.domElement.removeEventListener("pointercancel",Ge),e.domElement.removeEventListener("wheel",ve),e.domElement.removeEventListener("pointermove",Te),e.domElement.removeEventListener("pointerup",ye),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Ke)};const e=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const r=1e-6,a=new Ye,i=new Ye;let c=1;const f=new O;let l=!1;const d=new I,p=new I,g=new I,E=new I,m=new I,T=new I,w=new I,A=new I,L=new I,b=[],S={};function N(){return 2*Math.PI/60/60*e.autoRotateSpeed}function P(){return Math.pow(.95,e.zoomSpeed)}function D(u){i.theta-=u}function Z(u){i.phi-=u}const Y=function(){const u=new O;return function(x,M){u.setFromMatrixColumn(M,0),u.multiplyScalar(-x),f.add(u)}}(),U=function(){const u=new O;return function(x,M){e.screenSpacePanning===!0?u.setFromMatrixColumn(M,1):(u.setFromMatrixColumn(M,0),u.crossVectors(e.object.up,u)),u.multiplyScalar(x),f.add(u)}}(),_=function(){const u=new O;return function(x,M){const F=e.domElement;if(e.object.isPerspectiveCamera){const Q=e.object.position;u.copy(Q).sub(e.target);let ue=u.length();ue*=Math.tan(e.object.fov/2*Math.PI/180),Y(2*x*ue/F.clientHeight,e.object.matrix),U(2*M*ue/F.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(Y(x*(e.object.right-e.object.left)/e.object.zoom/F.clientWidth,e.object.matrix),U(M*(e.object.top-e.object.bottom)/e.object.zoom/F.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function v(u){e.object.isPerspectiveCamera?c/=u:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*u)),e.object.updateProjectionMatrix(),l=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function C(u){e.object.isPerspectiveCamera?c*=u:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/u)),e.object.updateProjectionMatrix(),l=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function oe(u){d.set(u.clientX,u.clientY)}function ge(u){w.set(u.clientX,u.clientY)}function le(u){E.set(u.clientX,u.clientY)}function At(u){p.set(u.clientX,u.clientY),g.subVectors(p,d).multiplyScalar(e.rotateSpeed);const y=e.domElement;D(2*Math.PI*g.x/y.clientHeight),Z(2*Math.PI*g.y/y.clientHeight),d.copy(p),e.update()}function Rt(u){A.set(u.clientX,u.clientY),L.subVectors(A,w),L.y>0?v(P()):L.y<0&&C(P()),w.copy(A),e.update()}function wt(u){m.set(u.clientX,u.clientY),T.subVectors(m,E).multiplyScalar(e.panSpeed),_(T.x,T.y),E.copy(m),e.update()}function Lt(u){u.deltaY<0?C(P()):u.deltaY>0&&v(P()),e.update()}function xt(u){let y=!1;switch(u.code){case e.keys.UP:u.ctrlKey||u.metaKey||u.shiftKey?Z(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):_(0,e.keyPanSpeed),y=!0;break;case e.keys.BOTTOM:u.ctrlKey||u.metaKey||u.shiftKey?Z(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):_(0,-e.keyPanSpeed),y=!0;break;case e.keys.LEFT:u.ctrlKey||u.metaKey||u.shiftKey?D(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):_(e.keyPanSpeed,0),y=!0;break;case e.keys.RIGHT:u.ctrlKey||u.metaKey||u.shiftKey?D(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):_(-e.keyPanSpeed,0),y=!0;break}y&&(u.preventDefault(),e.update())}function De(){if(b.length===1)d.set(b[0].pageX,b[0].pageY);else{const u=.5*(b[0].pageX+b[1].pageX),y=.5*(b[0].pageY+b[1].pageY);d.set(u,y)}}function ke(){if(b.length===1)E.set(b[0].pageX,b[0].pageY);else{const u=.5*(b[0].pageX+b[1].pageX),y=.5*(b[0].pageY+b[1].pageY);E.set(u,y)}}function Ce(){const u=b[0].pageX-b[1].pageX,y=b[0].pageY-b[1].pageY,x=Math.sqrt(u*u+y*y);w.set(0,x)}function _t(){e.enableZoom&&Ce(),e.enablePan&&ke()}function Mt(){e.enableZoom&&Ce(),e.enableRotate&&De()}function Fe(u){if(b.length==1)p.set(u.pageX,u.pageY);else{const x=Ee(u),M=.5*(u.pageX+x.x),F=.5*(u.pageY+x.y);p.set(M,F)}g.subVectors(p,d).multiplyScalar(e.rotateSpeed);const y=e.domElement;D(2*Math.PI*g.x/y.clientHeight),Z(2*Math.PI*g.y/y.clientHeight),d.copy(p)}function He(u){if(b.length===1)m.set(u.pageX,u.pageY);else{const y=Ee(u),x=.5*(u.pageX+y.x),M=.5*(u.pageY+y.y);m.set(x,M)}T.subVectors(m,E).multiplyScalar(e.panSpeed),_(T.x,T.y),E.copy(m)}function Ue(u){const y=Ee(u),x=u.pageX-y.x,M=u.pageY-y.y,F=Math.sqrt(x*x+M*M);A.set(0,F),L.set(0,Math.pow(A.y/w.y,e.zoomSpeed)),v(L.y),w.copy(A)}function St(u){e.enableZoom&&Ue(u),e.enablePan&&He(u)}function Nt(u){e.enableZoom&&Ue(u),e.enableRotate&&Fe(u)}function je(u){e.enabled!==!1&&(b.length===0&&(e.domElement.setPointerCapture(u.pointerId),e.domElement.addEventListener("pointermove",Te),e.domElement.addEventListener("pointerup",ye)),kt(u),u.pointerType==="touch"?Pt(u):It(u))}function Te(u){e.enabled!==!1&&(u.pointerType==="touch"?Dt(u):Ot(u))}function ye(u){Ve(u),b.length===0&&(e.domElement.releasePointerCapture(u.pointerId),e.domElement.removeEventListener("pointermove",Te),e.domElement.removeEventListener("pointerup",ye)),e.dispatchEvent(Qe),o=s.NONE}function Ge(u){Ve(u)}function It(u){let y;switch(u.button){case 0:y=e.mouseButtons.LEFT;break;case 1:y=e.mouseButtons.MIDDLE;break;case 2:y=e.mouseButtons.RIGHT;break;default:y=-1}switch(y){case J.DOLLY:if(e.enableZoom===!1)return;ge(u),o=s.DOLLY;break;case J.ROTATE:if(u.ctrlKey||u.metaKey||u.shiftKey){if(e.enablePan===!1)return;le(u),o=s.PAN}else{if(e.enableRotate===!1)return;oe(u),o=s.ROTATE}break;case J.PAN:if(u.ctrlKey||u.metaKey||u.shiftKey){if(e.enableRotate===!1)return;oe(u),o=s.ROTATE}else{if(e.enablePan===!1)return;le(u),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&e.dispatchEvent(Ae)}function Ot(u){switch(o){case s.ROTATE:if(e.enableRotate===!1)return;At(u);break;case s.DOLLY:if(e.enableZoom===!1)return;Rt(u);break;case s.PAN:if(e.enablePan===!1)return;wt(u);break}}function ve(u){e.enabled===!1||e.enableZoom===!1||o!==s.NONE||(u.preventDefault(),e.dispatchEvent(Ae),Lt(u),e.dispatchEvent(Qe))}function Ke(u){e.enabled===!1||e.enablePan===!1||xt(u)}function Pt(u){switch(ze(u),b.length){case 1:switch(e.touches.ONE){case $.ROTATE:if(e.enableRotate===!1)return;De(),o=s.TOUCH_ROTATE;break;case $.PAN:if(e.enablePan===!1)return;ke(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(e.touches.TWO){case $.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;_t(),o=s.TOUCH_DOLLY_PAN;break;case $.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Mt(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&e.dispatchEvent(Ae)}function Dt(u){switch(ze(u),o){case s.TOUCH_ROTATE:if(e.enableRotate===!1)return;Fe(u),e.update();break;case s.TOUCH_PAN:if(e.enablePan===!1)return;He(u),e.update();break;case s.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;St(u),e.update();break;case s.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Nt(u),e.update();break;default:o=s.NONE}}function Be(u){e.enabled!==!1&&u.preventDefault()}function kt(u){b.push(u)}function Ve(u){delete S[u.pointerId];for(let y=0;y<b.length;y++)if(b[y].pointerId==u.pointerId){b.splice(y,1);return}}function ze(u){let y=S[u.pointerId];y===void 0&&(y=new I,S[u.pointerId]=y),y.set(u.pageX,u.pageY)}function Ee(u){const y=u.pointerId===b[0].pointerId?b[1]:b[0];return S[y.pointerId]}e.domElement.addEventListener("contextmenu",Be),e.domElement.addEventListener("pointerdown",je),e.domElement.addEventListener("pointercancel",Ge),e.domElement.addEventListener("wheel",ve,{passive:!1}),this.update()}}const ne=new Ft,z=new ot(60,innerWidth/innerHeight,.1,100),H=new Ht({antialias:!0});H.setSize(innerWidth,innerHeight);H.setPixelRatio(Math.min(devicePixelRatio,2));H.outputEncoding=te;H.toneMapping=Ut;document.querySelector(".canvas-container").append(H.domElement);const mt=new Ln(z,H.domElement);onresize=()=>{z.aspect=innerWidth/innerHeight,z.updateProjectionMatrix(),H.setSize(innerWidth,innerHeight)};const de=document.querySelector(".progress-label"),Re={LOADING:"Loading model",DECODING:"Preparing a scene",ERROR:"Error"},xn=1134066,_n=getComputedStyle(document.body).backgroundColor,Mn=(h,t=1,n=.003)=>{const e=new I,s=new I;let o=!1,r=0;const a=()=>{const i=performance.now(),c=(i-r)*.001*t,f=e.x-s.x,l=e.y-s.y;s.x+=f*c,s.y+=l*c,r=i,h(s),Sn(f,l)>n?requestAnimationFrame(a):o=!1};addEventListener("pointermove",i=>{e.x=i.clientX/innerWidth-.5,e.y=-i.clientY/innerHeight+.5,!o&&(o=!0,r=performance.now(),requestAnimationFrame(a))})},Sn=(...h)=>h.reduce((t,n)=>t+Math.abs(n),Math.abs(h.pop()||0));function Je(h,t){if(t===jt)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),h;if(t===_e||t===rt){let n=h.getIndex();if(n===null){const r=[],a=h.getAttribute("position");if(a!==void 0){for(let i=0;i<a.count;i++)r.push(i);h.setIndex(r),n=h.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),h}const e=n.count-2,s=[];if(t===_e)for(let r=1;r<=e;r++)s.push(n.getX(0)),s.push(n.getX(r)),s.push(n.getX(r+1));else for(let r=0;r<e;r++)r%2===0?(s.push(n.getX(r)),s.push(n.getX(r+1)),s.push(n.getX(r+2))):(s.push(n.getX(r+2)),s.push(n.getX(r+1)),s.push(n.getX(r)));s.length/3!==e&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=h.clone();return o.setIndex(s),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),h}class Nn extends it{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new kn(n)}),this.register(function(n){return new vn(n)}),this.register(function(n){return new Kn(n)}),this.register(function(n){return new Fn(n)}),this.register(function(n){return new Hn(n)}),this.register(function(n){return new Un(n)}),this.register(function(n){return new jn(n)}),this.register(function(n){return new Dn(n)}),this.register(function(n){return new Gn(n)}),this.register(function(n){return new Cn(n)}),this.register(function(n){return new On(n)}),this.register(function(n){return new Bn(n)}),this.register(function(n){return new Vn(n)})}load(t,n,e,s){const o=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=Me.extractUrlBase(t),this.manager.itemStart(t);const a=function(c){s?s(c):console.error(c),o.manager.itemError(t),o.manager.itemEnd(t)},i=new pe(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,function(c){try{o.parse(c,r,function(f){n(f),o.manager.itemEnd(t)},a)}catch(f){a(f)}},e,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,n,e,s){let o;const r={},a={},i=new TextDecoder;if(typeof t=="string")o=JSON.parse(t);else if(t instanceof ArrayBuffer)if(i.decode(new Uint8Array(t,0,4))===gt){try{r[R.KHR_BINARY_GLTF]=new zn(t)}catch(l){s&&s(l);return}o=JSON.parse(r[R.KHR_BINARY_GLTF].content)}else o=JSON.parse(i.decode(t));else o=t;if(o.asset===void 0||o.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new os(o,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const l=this.pluginCallbacks[f](c);a[l.name]=l,r[l.name]=!0}if(o.extensionsUsed)for(let f=0;f<o.extensionsUsed.length;++f){const l=o.extensionsUsed[f],d=o.extensionsRequired||[];switch(l){case R.KHR_MATERIALS_UNLIT:r[l]=new Pn;break;case R.KHR_DRACO_MESH_COMPRESSION:r[l]=new Xn(o,this.dracoLoader);break;case R.KHR_TEXTURE_TRANSFORM:r[l]=new Yn;break;case R.KHR_MESH_QUANTIZATION:r[l]=new qn;break;default:d.indexOf(l)>=0&&a[l]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}c.setExtensions(r),c.setPlugins(a),c.parse(e,s)}parseAsync(t,n){const e=this;return new Promise(function(s,o){e.parse(t,n,s,o)})}}function In(){let h={};return{get:function(t){return h[t]},add:function(t,n){h[t]=n},remove:function(t){delete h[t]},removeAll:function(){h={}}}}const R={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class On{constructor(t){this.parser=t,this.name=R.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,n=this.parser.json.nodes||[];for(let e=0,s=n.length;e<s;e++){const o=n[e];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(t){const n=this.parser,e="light:"+t;let s=n.cache.get(e);if(s)return s;const o=n.json,i=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t];let c;const f=new X(16777215);i.color!==void 0&&f.fromArray(i.color);const l=i.range!==void 0?i.range:0;switch(i.type){case"directional":c=new at(f),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new vt(f),c.distance=l;break;case"spot":c=new Gt(f),c.distance=l,i.spot=i.spot||{},i.spot.innerConeAngle=i.spot.innerConeAngle!==void 0?i.spot.innerConeAngle:0,i.spot.outerConeAngle=i.spot.outerConeAngle!==void 0?i.spot.outerConeAngle:Math.PI/4,c.angle=i.spot.outerConeAngle,c.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+i.type)}return c.position.set(0,0,0),c.decay=2,V(c,i),i.intensity!==void 0&&(c.intensity=i.intensity),c.name=n.createUniqueName(i.name||"light_"+t),s=Promise.resolve(c),n.cache.add(e,s),s}getDependency(t,n){if(t==="light")return this._loadLight(n)}createNodeAttachment(t){const n=this,e=this.parser,o=e.json.nodes[t],a=(o.extensions&&o.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(i){return e._getNodeRef(n.cache,a,i)})}}class Pn{constructor(){this.name=R.KHR_MATERIALS_UNLIT}getMaterialType(){return ae}extendParams(t,n,e){const s=[];t.color=new X(1,1,1),t.opacity=1;const o=n.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const r=o.baseColorFactor;t.color.fromArray(r),t.opacity=r[3]}o.baseColorTexture!==void 0&&s.push(e.assignTexture(t,"map",o.baseColorTexture,te))}return Promise.all(s)}}class Dn{constructor(t){this.parser=t,this.name=R.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name].emissiveStrength;return o!==void 0&&(n.emissiveIntensity=o),Promise.resolve()}}class kn{constructor(t){this.parser=t,this.name=R.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:W}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(n.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&o.push(e.assignTexture(n,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&o.push(e.assignTexture(n,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(o.push(e.assignTexture(n,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new I(a,a)}return Promise.all(o)}}class Cn{constructor(t){this.parser=t,this.name=R.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:W}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(n.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&o.push(e.assignTexture(n,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(n.iridescenceIOR=r.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&o.push(e.assignTexture(n,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(o)}}class Fn{constructor(t){this.parser=t,this.name=R.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:W}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[];n.sheenColor=new X(0,0,0),n.sheenRoughness=0,n.sheen=1;const r=s.extensions[this.name];return r.sheenColorFactor!==void 0&&n.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&o.push(e.assignTexture(n,"sheenColorMap",r.sheenColorTexture,te)),r.sheenRoughnessTexture!==void 0&&o.push(e.assignTexture(n,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(o)}}class Hn{constructor(t){this.parser=t,this.name=R.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:W}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(n.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&o.push(e.assignTexture(n,"transmissionMap",r.transmissionTexture)),Promise.all(o)}}class Un{constructor(t){this.parser=t,this.name=R.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:W}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];n.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&o.push(e.assignTexture(n,"thicknessMap",r.thicknessTexture)),n.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return n.attenuationColor=new X(a[0],a[1],a[2]),Promise.all(o)}}class jn{constructor(t){this.parser=t,this.name=R.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:W}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return n.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class Gn{constructor(t){this.parser=t,this.name=R.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:W}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];n.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&o.push(e.assignTexture(n,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return n.specularColor=new X(a[0],a[1],a[2]),r.specularColorTexture!==void 0&&o.push(e.assignTexture(n,"specularColorMap",r.specularColorTexture,te)),Promise.all(o)}}class vn{constructor(t){this.parser=t,this.name=R.KHR_TEXTURE_BASISU}loadTexture(t){const n=this.parser,e=n.json,s=e.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const o=s.extensions[this.name],r=n.options.ktx2Loader;if(!r){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(t,o.source,r)}}class Kn{constructor(t){this.parser=t,this.name=R.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const n=this.name,e=this.parser,s=e.json,o=s.textures[t];if(!o.extensions||!o.extensions[n])return null;const r=o.extensions[n],a=s.images[r.source];let i=e.textureLoader;if(a.uri){const c=e.options.manager.getHandler(a.uri);c!==null&&(i=c)}return this.detectSupport().then(function(c){if(c)return e.loadTextureImage(t,r.source,i);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return e.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){t(n.height===1)}})),this.isSupported}}class Bn{constructor(t){this.name=R.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const n=this.parser.json,e=n.bufferViews[t];if(e.extensions&&e.extensions[this.name]){const s=e.extensions[this.name],o=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(a){const i=s.byteOffset||0,c=s.byteLength||0,f=s.count,l=s.byteStride,d=new Uint8Array(a,i,c);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(f,l,d,s.mode,s.filter).then(function(p){return p.buffer}):r.ready.then(function(){const p=new ArrayBuffer(f*l);return r.decodeGltfBuffer(new Uint8Array(p),f,l,d,s.mode,s.filter),p})})}else return null}}class Vn{constructor(t){this.name=R.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const n=this.parser.json,e=n.nodes[t];if(!e.extensions||!e.extensions[this.name]||e.mesh===void 0)return null;const s=n.meshes[e.mesh];for(const c of s.primitives)if(c.mode!==k.TRIANGLES&&c.mode!==k.TRIANGLE_STRIP&&c.mode!==k.TRIANGLE_FAN&&c.mode!==void 0)return null;const r=e.extensions[this.name].attributes,a=[],i={};for(const c in r)a.push(this.parser.getDependency("accessor",r[c]).then(f=>(i[c]=f,i[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(c=>{const f=c.pop(),l=f.isGroup?f.children:[f],d=c[0].count,p=[];for(const g of l){const E=new me,m=new O,T=new he,w=new O(1,1,1),A=new Kt(g.geometry,g.material,d);for(let L=0;L<d;L++)i.TRANSLATION&&m.fromBufferAttribute(i.TRANSLATION,L),i.ROTATION&&T.fromBufferAttribute(i.ROTATION,L),i.SCALE&&w.fromBufferAttribute(i.SCALE,L),A.setMatrixAt(L,E.compose(m,T,w));for(const L in i)L!=="TRANSLATION"&&L!=="ROTATION"&&L!=="SCALE"&&g.geometry.setAttribute(L,i[L]);ct.prototype.copy.call(A,g),A.frustumCulled=!1,this.parser.assignFinalMaterial(A),p.push(A)}return f.isGroup?(f.clear(),f.add(...p),f):p[0]}))}}const gt="glTF",re=12,$e={JSON:1313821514,BIN:5130562};class zn{constructor(t){this.name=R.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(t,0,re),e=new TextDecoder;if(this.header={magic:e.decode(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==gt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-re,o=new DataView(t,re);let r=0;for(;r<s;){const a=o.getUint32(r,!0);r+=4;const i=o.getUint32(r,!0);if(r+=4,i===$e.JSON){const c=new Uint8Array(t,re+r,a);this.content=e.decode(c)}else if(i===$e.BIN){const c=re+r;this.body=t.slice(c,c+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Xn{constructor(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=R.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(t,n){const e=this.json,s=this.dracoLoader,o=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,a={},i={},c={};for(const f in r){const l=Ne[f]||f.toLowerCase();a[l]=r[f]}for(const f in t.attributes){const l=Ne[f]||f.toLowerCase();if(r[f]!==void 0){const d=e.accessors[t.attributes[f]],p=ee[d.componentType];c[l]=p.name,i[l]=d.normalized===!0}}return n.getDependency("bufferView",o).then(function(f){return new Promise(function(l){s.decodeDracoFile(f,function(d){for(const p in d.attributes){const g=d.attributes[p],E=i[p];E!==void 0&&(g.normalized=E)}l(d)},a,c)})})}}class Yn{constructor(){this.name=R.KHR_TEXTURE_TRANSFORM}extendTexture(t,n){return n.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(t=t.clone(),n.offset!==void 0&&t.offset.fromArray(n.offset),n.rotation!==void 0&&(t.rotation=n.rotation),n.scale!==void 0&&t.repeat.fromArray(n.scale),t.needsUpdate=!0),t}}class qn{constructor(){this.name=R.KHR_MESH_QUANTIZATION}}class Tt extends En{constructor(t,n,e,s){super(t,n,e,s)}copySampleValue_(t){const n=this.resultBuffer,e=this.sampleValues,s=this.valueSize,o=t*s*3+s;for(let r=0;r!==s;r++)n[r]=e[o+r];return n}interpolate_(t,n,e,s){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,i=a*2,c=a*3,f=s-n,l=(e-n)/f,d=l*l,p=d*l,g=t*c,E=g-c,m=-2*p+3*d,T=p-d,w=1-m,A=T-d+l;for(let L=0;L!==a;L++){const b=r[E+L+a],S=r[E+L+i]*f,N=r[g+L+a],P=r[g+L]*f;o[L]=w*b+A*S+m*N+T*P}return o}}const Wn=new he;class Zn extends Tt{interpolate_(t,n,e,s){const o=super.interpolate_(t,n,e,s);return Wn.fromArray(o).normalize().toArray(o),o}}const k={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ee={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},et={9728:an,9729:lt,9984:cn,9985:ln,9986:un,9987:ut},tt={33071:dn,33648:fn,10497:Se},we={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ne={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},K={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Qn={CUBICSPLINE:void 0,LINEAR:pt,STEP:hn},Le={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Jn(h){return h.DefaultMaterial===void 0&&(h.DefaultMaterial=new B({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:pn})),h.DefaultMaterial}function ie(h,t,n){for(const e in n.extensions)h[e]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[e]=n.extensions[e])}function V(h,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(h.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function $n(h,t,n){let e=!1,s=!1,o=!1;for(let c=0,f=t.length;c<f;c++){const l=t[c];if(l.POSITION!==void 0&&(e=!0),l.NORMAL!==void 0&&(s=!0),l.COLOR_0!==void 0&&(o=!0),e&&s&&o)break}if(!e&&!s&&!o)return Promise.resolve(h);const r=[],a=[],i=[];for(let c=0,f=t.length;c<f;c++){const l=t[c];if(e){const d=l.POSITION!==void 0?n.getDependency("accessor",l.POSITION):h.attributes.position;r.push(d)}if(s){const d=l.NORMAL!==void 0?n.getDependency("accessor",l.NORMAL):h.attributes.normal;a.push(d)}if(o){const d=l.COLOR_0!==void 0?n.getDependency("accessor",l.COLOR_0):h.attributes.color;i.push(d)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(i)]).then(function(c){const f=c[0],l=c[1],d=c[2];return e&&(h.morphAttributes.position=f),s&&(h.morphAttributes.normal=l),o&&(h.morphAttributes.color=d),h.morphTargetsRelative=!0,h})}function es(h,t){if(h.updateMorphTargets(),t.weights!==void 0)for(let n=0,e=t.weights.length;n<e;n++)h.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(h.morphTargetInfluences.length===n.length){h.morphTargetDictionary={};for(let e=0,s=n.length;e<s;e++)h.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ts(h){const t=h.extensions&&h.extensions[R.KHR_DRACO_MESH_COMPRESSION];let n;return t?n="draco:"+t.bufferView+":"+t.indices+":"+nt(t.attributes):n=h.indices+":"+nt(h.attributes)+":"+h.mode,n}function nt(h){let t="";const n=Object.keys(h).sort();for(let e=0,s=n.length;e<s;e++)t+=n[e]+":"+h[n[e]]+";";return t}function Ie(h){switch(h){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function ns(h){return h.search(/\.jpe?g($|\?)/i)>0||h.search(/^data\:image\/jpeg/)===0?"image/jpeg":h.search(/\.webp($|\?)/i)>0||h.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const ss=new me;class os{constructor(t={},n={}){this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new In,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let e=!1,s=!1,o=-1;typeof navigator<"u"&&(e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,o=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||e||s&&o<98?this.textureLoader=new Bt(this.options.manager):this.textureLoader=new Vt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new pe(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,n){const e=this,s=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([e.getDependencies("scene"),e.getDependencies("animation"),e.getDependencies("camera")])}).then(function(r){const a={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:e,userData:{}};ie(o,a,s),V(a,s),Promise.all(e._invokeAll(function(i){return i.afterRoot&&i.afterRoot(a)})).then(function(){t(a)})}).catch(n)}_markDefs(){const t=this.json.nodes||[],n=this.json.skins||[],e=this.json.meshes||[];for(let s=0,o=n.length;s<o;s++){const r=n[s].joints;for(let a=0,i=r.length;a<i;a++)t[r[a]].isBone=!0}for(let s=0,o=t.length;s<o;s++){const r=t[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(e[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(t,n){n!==void 0&&(t.refs[n]===void 0&&(t.refs[n]=t.uses[n]=0),t.refs[n]++)}_getNodeRef(t,n,e){if(t.refs[n]<=1)return e;const s=e.clone(),o=(r,a)=>{const i=this.associations.get(r);i!=null&&this.associations.set(a,i);for(const[c,f]of r.children.entries())o(f,a.children[c])};return o(e,s),s.name+="_instance_"+t.uses[n]++,s}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let e=0;e<n.length;e++){const s=t(n[e]);if(s)return s}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const e=[];for(let s=0;s<n.length;s++){const o=t(n[s]);o&&e.push(o)}return e}getDependency(t,n){const e=t+":"+n;let s=this.cache.get(e);if(!s){switch(t){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(o){return o.loadNode&&o.loadNode(n)});break;case"mesh":s=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(t,n)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(e,s)}return s}getDependencies(t){let n=this.cache.get(t);if(!n){const e=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(o,r){return e.getDependency(t,r)})),this.cache.add(t,n)}return n}loadBuffer(t){const n=this.json.buffers[t],e=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&t===0)return Promise.resolve(this.extensions[R.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(o,r){e.load(Me.resolveURL(n.uri,s.path),o,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(t){const n=this.json.bufferViews[t];return this.getDependency("buffer",n.buffer).then(function(e){const s=n.byteLength||0,o=n.byteOffset||0;return e.slice(o,o+s)})}loadAccessor(t){const n=this,e=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const r=we[s.type],a=ee[s.componentType],i=s.normalized===!0,c=new a(s.count*r);return Promise.resolve(new ce(c,r,i))}const o=[];return s.bufferView!==void 0?o.push(this.getDependency("bufferView",s.bufferView)):o.push(null),s.sparse!==void 0&&(o.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(o).then(function(r){const a=r[0],i=we[s.type],c=ee[s.componentType],f=c.BYTES_PER_ELEMENT,l=f*i,d=s.byteOffset||0,p=s.bufferView!==void 0?e.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let E,m;if(p&&p!==l){const T=Math.floor(d/p),w="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+T+":"+s.count;let A=n.cache.get(w);A||(E=new c(a,T*p,s.count*p/f),A=new zt(E,p/f),n.cache.add(w,A)),m=new Xt(A,i,d%p/f,g)}else a===null?E=new c(s.count*i):E=new c(a,d,s.count*i),m=new ce(E,i,g);if(s.sparse!==void 0){const T=we.SCALAR,w=ee[s.sparse.indices.componentType],A=s.sparse.indices.byteOffset||0,L=s.sparse.values.byteOffset||0,b=new w(r[1],A,s.sparse.count*T),S=new c(r[2],L,s.sparse.count*i);a!==null&&(m=new ce(m.array.slice(),m.itemSize,m.normalized));for(let N=0,P=b.length;N<P;N++){const D=b[N];if(m.setX(D,S[N*i]),i>=2&&m.setY(D,S[N*i+1]),i>=3&&m.setZ(D,S[N*i+2]),i>=4&&m.setW(D,S[N*i+3]),i>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(t){const n=this.json,e=this.options,o=n.textures[t].source,r=n.images[o];let a=this.textureLoader;if(r.uri){const i=e.manager.getHandler(r.uri);i!==null&&(a=i)}return this.loadTextureImage(t,o,a)}loadTextureImage(t,n,e){const s=this,o=this.json,r=o.textures[t],a=o.images[n],i=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[i])return this.textureCache[i];const c=this.loadImageSource(n,e).then(function(f){f.flipY=!1,f.name=r.name||a.name||"";const d=(o.samplers||{})[r.sampler]||{};return f.magFilter=et[d.magFilter]||lt,f.minFilter=et[d.minFilter]||ut,f.wrapS=tt[d.wrapS]||Se,f.wrapT=tt[d.wrapT]||Se,s.associations.set(f,{textures:t}),f}).catch(function(){return null});return this.textureCache[i]=c,c}loadImageSource(t,n){const e=this,s=this.json,o=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(l=>l.clone());const r=s.images[t],a=self.URL||self.webkitURL;let i=r.uri||"",c=!1;if(r.bufferView!==void 0)i=e.getDependency("bufferView",r.bufferView).then(function(l){c=!0;const d=new Blob([l],{type:r.mimeType});return i=a.createObjectURL(d),i});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const f=Promise.resolve(i).then(function(l){return new Promise(function(d,p){let g=d;n.isImageBitmapLoader===!0&&(g=function(E){const m=new qe(E);m.needsUpdate=!0,d(m)}),n.load(Me.resolveURL(l,o.path),g,void 0,p)})}).then(function(l){return c===!0&&a.revokeObjectURL(i),l.userData.mimeType=r.mimeType||ns(r.uri),l}).catch(function(l){throw console.error("THREE.GLTFLoader: Couldn't load texture",i),l});return this.sourceCache[t]=f,f}assignTexture(t,n,e,s){const o=this;return this.getDependency("texture",e.index).then(function(r){if(!r)return null;if(e.texCoord!==void 0&&e.texCoord!=0&&!(n==="aoMap"&&e.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+e.texCoord+" for texture "+n+" not yet supported."),o.extensions[R.KHR_TEXTURE_TRANSFORM]){const a=e.extensions!==void 0?e.extensions[R.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const i=o.associations.get(r);r=o.extensions[R.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),o.associations.set(r,i)}}return s!==void 0&&(r.encoding=s),t[n]=r,r})}assignFinalMaterial(t){const n=t.geometry;let e=t.material;const s=n.attributes.tangent===void 0,o=n.attributes.color!==void 0,r=n.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+e.uuid;let i=this.cache.get(a);i||(i=new Yt,be.prototype.copy.call(i,e),i.color.copy(e.color),i.map=e.map,i.sizeAttenuation=!1,this.cache.add(a,i)),e=i}else if(t.isLine){const a="LineBasicMaterial:"+e.uuid;let i=this.cache.get(a);i||(i=new qt,be.prototype.copy.call(i,e),i.color.copy(e.color),this.cache.add(a,i)),e=i}if(s||o||r){let a="ClonedMaterial:"+e.uuid+":";s&&(a+="derivative-tangents:"),o&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let i=this.cache.get(a);i||(i=e.clone(),o&&(i.vertexColors=!0),r&&(i.flatShading=!0),s&&(i.normalScale&&(i.normalScale.y*=-1),i.clearcoatNormalScale&&(i.clearcoatNormalScale.y*=-1)),this.cache.add(a,i),this.associations.set(i,this.associations.get(e))),e=i}e.aoMap&&n.attributes.uv2===void 0&&n.attributes.uv!==void 0&&n.setAttribute("uv2",n.attributes.uv),t.material=e}getMaterialType(){return B}loadMaterial(t){const n=this,e=this.json,s=this.extensions,o=e.materials[t];let r;const a={},i=o.extensions||{},c=[];if(i[R.KHR_MATERIALS_UNLIT]){const l=s[R.KHR_MATERIALS_UNLIT];r=l.getMaterialType(),c.push(l.extendParams(a,o,n))}else{const l=o.pbrMetallicRoughness||{};if(a.color=new X(1,1,1),a.opacity=1,Array.isArray(l.baseColorFactor)){const d=l.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}l.baseColorTexture!==void 0&&c.push(n.assignTexture(a,"map",l.baseColorTexture,te)),a.metalness=l.metallicFactor!==void 0?l.metallicFactor:1,a.roughness=l.roughnessFactor!==void 0?l.roughnessFactor:1,l.metallicRoughnessTexture!==void 0&&(c.push(n.assignTexture(a,"metalnessMap",l.metallicRoughnessTexture)),c.push(n.assignTexture(a,"roughnessMap",l.metallicRoughnessTexture))),r=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(t,a)})))}o.doubleSided===!0&&(a.side=dt);const f=o.alphaMode||Le.OPAQUE;if(f===Le.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,f===Le.MASK&&(a.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&r!==ae&&(c.push(n.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new I(1,1),o.normalTexture.scale!==void 0)){const l=o.normalTexture.scale;a.normalScale.set(l,l)}return o.occlusionTexture!==void 0&&r!==ae&&(c.push(n.assignTexture(a,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&r!==ae&&(a.emissive=new X().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&r!==ae&&c.push(n.assignTexture(a,"emissiveMap",o.emissiveTexture,te)),Promise.all(c).then(function(){const l=new r(a);return o.name&&(l.name=o.name),V(l,o),n.associations.set(l,{materials:t}),o.extensions&&ie(s,l,o),l})}createUniqueName(t){const n=Wt.sanitizeNodeName(t||"");let e=n;for(let s=1;this.nodeNamesUsed[e];++s)e=n+"_"+s;return this.nodeNamesUsed[e]=!0,e}loadGeometries(t){const n=this,e=this.extensions,s=this.primitiveCache;function o(a){return e[R.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(i){return st(i,a,n)})}const r=[];for(let a=0,i=t.length;a<i;a++){const c=t[a],f=ts(c),l=s[f];if(l)r.push(l.promise);else{let d;c.extensions&&c.extensions[R.KHR_DRACO_MESH_COMPRESSION]?d=o(c):d=st(new ft,c,n),s[f]={primitive:c,promise:d},r.push(d)}}return Promise.all(r)}loadMesh(t){const n=this,e=this.json,s=this.extensions,o=e.meshes[t],r=o.primitives,a=[];for(let i=0,c=r.length;i<c;i++){const f=r[i].material===void 0?Jn(this.cache):this.getDependency("material",r[i].material);a.push(f)}return a.push(n.loadGeometries(r)),Promise.all(a).then(function(i){const c=i.slice(0,i.length-1),f=i[i.length-1],l=[];for(let p=0,g=f.length;p<g;p++){const E=f[p],m=r[p];let T;const w=c[p];if(m.mode===k.TRIANGLES||m.mode===k.TRIANGLE_STRIP||m.mode===k.TRIANGLE_FAN||m.mode===void 0)T=o.isSkinnedMesh===!0?new Zt(E,w):new ht(E,w),T.isSkinnedMesh===!0&&!T.geometry.attributes.skinWeight.normalized&&T.normalizeSkinWeights(),m.mode===k.TRIANGLE_STRIP?T.geometry=Je(T.geometry,rt):m.mode===k.TRIANGLE_FAN&&(T.geometry=Je(T.geometry,_e));else if(m.mode===k.LINES)T=new Qt(E,w);else if(m.mode===k.LINE_STRIP)T=new Jt(E,w);else if(m.mode===k.LINE_LOOP)T=new $t(E,w);else if(m.mode===k.POINTS)T=new en(E,w);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(T.geometry.morphAttributes).length>0&&es(T,o),T.name=n.createUniqueName(o.name||"mesh_"+t),V(T,o),m.extensions&&ie(s,T,m),n.assignFinalMaterial(T),l.push(T)}for(let p=0,g=l.length;p<g;p++)n.associations.set(l[p],{meshes:t,primitives:p});if(l.length===1)return l[0];const d=new fe;n.associations.set(d,{meshes:t});for(let p=0,g=l.length;p<g;p++)d.add(l[p]);return d})}loadCamera(t){let n;const e=this.json.cameras[t],s=e[e.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return e.type==="perspective"?n=new ot(tn.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):e.type==="orthographic"&&(n=new nn(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),e.name&&(n.name=this.createUniqueName(e.name)),V(n,e),Promise.resolve(n)}loadSkin(t){const n=this.json.skins[t],e=[];for(let s=0,o=n.joints.length;s<o;s++)e.push(this.getDependency("node",n.joints[s]));return n.inverseBindMatrices!==void 0?e.push(this.getDependency("accessor",n.inverseBindMatrices)):e.push(null),Promise.all(e).then(function(s){const o=s.pop(),r=s,a=[],i=[];for(let c=0,f=r.length;c<f;c++){const l=r[c];if(l){a.push(l);const d=new me;o!==null&&d.fromArray(o.array,c*16),i.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[c])}return new sn(a,i)})}loadAnimation(t){const e=this.json.animations[t],s=[],o=[],r=[],a=[],i=[];for(let c=0,f=e.channels.length;c<f;c++){const l=e.channels[c],d=e.samplers[l.sampler],p=l.target,g=p.node,E=e.parameters!==void 0?e.parameters[d.input]:d.input,m=e.parameters!==void 0?e.parameters[d.output]:d.output;s.push(this.getDependency("node",g)),o.push(this.getDependency("accessor",E)),r.push(this.getDependency("accessor",m)),a.push(d),i.push(p)}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(r),Promise.all(a),Promise.all(i)]).then(function(c){const f=c[0],l=c[1],d=c[2],p=c[3],g=c[4],E=[];for(let T=0,w=f.length;T<w;T++){const A=f[T],L=l[T],b=d[T],S=p[T],N=g[T];if(A===void 0)continue;A.updateMatrix();let P;switch(K[N.path]){case K.weights:P=gn;break;case K.rotation:P=We;break;case K.position:case K.scale:default:P=mn;break}const D=A.name?A.name:A.uuid,Z=S.interpolation!==void 0?Qn[S.interpolation]:pt,Y=[];K[N.path]===K.weights?A.traverse(function(_){_.morphTargetInfluences&&Y.push(_.name?_.name:_.uuid)}):Y.push(D);let U=b.array;if(b.normalized){const _=Ie(U.constructor),v=new Float32Array(U.length);for(let C=0,oe=U.length;C<oe;C++)v[C]=U[C]*_;U=v}for(let _=0,v=Y.length;_<v;_++){const C=new P(Y[_]+"."+K[N.path],L.array,U,Z);S.interpolation==="CUBICSPLINE"&&(C.createInterpolant=function(ge){const le=this instanceof We?Zn:Tt;return new le(this.times,this.values,this.getValueSize()/3,ge)},C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),E.push(C)}}const m=e.name?e.name:"animation_"+t;return new on(m,void 0,E)})}createNodeMesh(t){const n=this.json,e=this,s=n.nodes[t];return s.mesh===void 0?null:e.getDependency("mesh",s.mesh).then(function(o){const r=e._getNodeRef(e.meshCache,s.mesh,o);return s.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let i=0,c=s.weights.length;i<c;i++)a.morphTargetInfluences[i]=s.weights[i]}),r})}loadNode(t){const n=this.json,e=this.extensions,s=this,o=n.nodes[t],r=o.name?s.createUniqueName(o.name):"";return function(){const a=[],i=s._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(t)});i&&a.push(i),o.camera!==void 0&&a.push(s.getDependency("camera",o.camera).then(function(d){return s._getNodeRef(s.cameraCache,o.camera,d)})),s._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(t)}).forEach(function(d){a.push(d)});const c=[],f=o.children||[];for(let d=0,p=f.length;d<p;d++)c.push(s.getDependency("node",f[d]));const l=o.skin===void 0?Promise.resolve(null):s.getDependency("skin",o.skin);return Promise.all([Promise.all(a),Promise.all(c),l])}().then(function(a){const i=a[0],c=a[1],f=a[2];let l;if(o.isBone===!0?l=new rn:i.length>1?l=new fe:i.length===1?l=i[0]:l=new ct,l!==i[0])for(let d=0,p=i.length;d<p;d++)l.add(i[d]);if(o.name&&(l.userData.name=o.name,l.name=r),V(l,o),o.extensions&&ie(e,l,o),o.matrix!==void 0){const d=new me;d.fromArray(o.matrix),l.applyMatrix4(d)}else o.translation!==void 0&&l.position.fromArray(o.translation),o.rotation!==void 0&&l.quaternion.fromArray(o.rotation),o.scale!==void 0&&l.scale.fromArray(o.scale);s.associations.has(l)||s.associations.set(l,{}),s.associations.get(l).nodes=t,f!==null&&l.traverse(function(d){d.isSkinnedMesh&&d.bind(f,ss)});for(let d=0,p=c.length;d<p;d++)l.add(c[d]);return l})}loadScene(t){const n=this.extensions,e=this.json.scenes[t],s=this,o=new fe;e.name&&(o.name=s.createUniqueName(e.name)),V(o,e),e.extensions&&ie(n,o,e);const r=e.nodes||[],a=[];for(let i=0,c=r.length;i<c;i++)a.push(s.getDependency("node",r[i]));return Promise.all(a).then(function(i){for(let f=0,l=i.length;f<l;f++)o.add(i[f]);const c=f=>{const l=new Map;for(const[d,p]of s.associations)(d instanceof be||d instanceof qe)&&l.set(d,p);return f.traverse(d=>{const p=s.associations.get(d);p!=null&&l.set(d,p)}),l};return s.associations=c(o),o})}}function rs(h,t,n){const e=t.attributes,s=new Tn;if(e.POSITION!==void 0){const a=n.json.accessors[e.POSITION],i=a.min,c=a.max;if(i!==void 0&&c!==void 0){if(s.set(new O(i[0],i[1],i[2]),new O(c[0],c[1],c[2])),a.normalized){const f=Ie(ee[a.componentType]);s.min.multiplyScalar(f),s.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=t.targets;if(o!==void 0){const a=new O,i=new O;for(let c=0,f=o.length;c<f;c++){const l=o[c];if(l.POSITION!==void 0){const d=n.json.accessors[l.POSITION],p=d.min,g=d.max;if(p!==void 0&&g!==void 0){if(i.setX(Math.max(Math.abs(p[0]),Math.abs(g[0]))),i.setY(Math.max(Math.abs(p[1]),Math.abs(g[1]))),i.setZ(Math.max(Math.abs(p[2]),Math.abs(g[2]))),d.normalized){const E=Ie(ee[d.componentType]);i.multiplyScalar(E)}a.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}h.boundingBox=s;const r=new yn;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,h.boundingSphere=r}function st(h,t,n){const e=t.attributes,s=[];function o(r,a){return n.getDependency("accessor",r).then(function(i){h.setAttribute(a,i)})}for(const r in e){const a=Ne[r]||r.toLowerCase();a in h.attributes||s.push(o(e[r],a))}if(t.indices!==void 0&&!h.index){const r=n.getDependency("accessor",t.indices).then(function(a){h.setIndex(a)});s.push(r)}return V(h,t),rs(h,t,n),Promise.all(s).then(function(){return t.targets!==void 0?$n(h,t.targets,n):h})}const xe=new WeakMap;class is extends it{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,n,e,s){const o=new pe(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,r=>{this.decodeDracoFile(r,n).catch(s)},e,s)}decodeDracoFile(t,n,e,s){const o={attributeIDs:e||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!e};return this.decodeGeometry(t,o).then(n)}decodeGeometry(t,n){const e=JSON.stringify(n);if(xe.has(t)){const i=xe.get(t);if(i.key===e)return i.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const o=this.workerNextTaskID++,r=t.byteLength,a=this._getWorker(o,r).then(i=>(s=i,new Promise((c,f)=>{s._callbacks[o]={resolve:c,reject:f},s.postMessage({type:"decode",id:o,taskConfig:n,buffer:t},[t])}))).then(i=>this._createGeometry(i.geometry));return a.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),xe.set(t,{key:e,promise:a}),a}_createGeometry(t){const n=new ft;t.index&&n.setIndex(new ce(t.index.array,1));for(let e=0;e<t.attributes.length;e++){const s=t.attributes[e],o=s.name,r=s.array,a=s.itemSize;n.setAttribute(o,new ce(r,a))}return n}_loadLibrary(t,n){const e=new pe(this.manager);return e.setPath(this.decoderPath),e.setResponseType(n),e.setWithCredentials(this.withCredentials),new Promise((s,o)=>{e.load(t,s,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(e=>{const s=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const o=as.toString(),r=["/* draco decoder */",s,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(t,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(o){const r=o.data;switch(r.type){case"decode":s._callbacks[r.id].resolve(r);break;case"error":s._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const e=this.workerPool[this.workerPool.length-1];return e._taskCosts[t]=n,e._taskLoad+=n,e})}_releaseTask(t,n){t._taskLoad-=t._taskCosts[n],delete t._callbacks[n],delete t._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function as(){let h,t;onmessage=function(r){const a=r.data;switch(a.type){case"init":h=a.decoderConfig,t=new Promise(function(f){h.onModuleLoaded=function(l){f({draco:l})},DracoDecoderModule(h)});break;case"decode":const i=a.buffer,c=a.taskConfig;t.then(f=>{const l=f.draco,d=new l.Decoder,p=new l.DecoderBuffer;p.Init(new Int8Array(i),i.byteLength);try{const g=n(l,d,p,c),E=g.attributes.map(m=>m.array.buffer);g.index&&E.push(g.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:g},E)}catch(g){console.error(g),self.postMessage({type:"error",id:a.id,error:g.message})}finally{l.destroy(p),l.destroy(d)}});break}};function n(r,a,i,c){const f=c.attributeIDs,l=c.attributeTypes;let d,p;const g=a.GetEncodedGeometryType(i);if(g===r.TRIANGULAR_MESH)d=new r.Mesh,p=a.DecodeBufferToMesh(i,d);else if(g===r.POINT_CLOUD)d=new r.PointCloud,p=a.DecodeBufferToPointCloud(i,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const E={index:null,attributes:[]};for(const m in f){const T=self[l[m]];let w,A;if(c.useUniqueIDs)A=f[m],w=a.GetAttributeByUniqueId(d,A);else{if(A=a.GetAttributeId(d,r[f[m]]),A===-1)continue;w=a.GetAttribute(d,A)}E.attributes.push(s(r,a,d,m,T,w))}return g===r.TRIANGULAR_MESH&&(E.index=e(r,a,d)),r.destroy(d),E}function e(r,a,i){const f=i.num_faces()*3,l=f*4,d=r._malloc(l);a.GetTrianglesUInt32Array(i,l,d);const p=new Uint32Array(r.HEAPF32.buffer,d,f).slice();return r._free(d),{array:p,itemSize:1}}function s(r,a,i,c,f,l){const d=l.num_components(),g=i.num_points()*d,E=g*f.BYTES_PER_ELEMENT,m=o(r,f),T=r._malloc(E);a.GetAttributeDataArrayForAllPoints(i,l,m,E,T);const w=new f(r.HEAPF32.buffer,T,g).slice();return r._free(T),{name:c,array:w,itemSize:d}}function o(r,a){switch(a){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}const yt="https://foretoo.github.io/narkomfin";let Oe;const Pe=new bn;Pe.itemStart=h=>{/^data:/.test(h)&&Oe&&Oe()};const Et=new is(Pe);Et.setDecoderPath(yt+"/dist/vendor/");const bt=new Nn(Pe);bt.setDRACOLoader(Et);const cs=(h,t,n)=>(Oe=n,new Promise(e=>{bt.load(yt+"/public/narkom_compressed.gltf",e,h,t)})),se=new An;mt.object=se;se.position.set(1,3,6);se.add(z);ne.add(se);Mn(h=>{z.position.x=-h.x,z.position.y=-h.y,z.lookAt(ne.position)},5);ne.background=new X(_n);H.shadowMap.enabled=!0;H.shadowMap.type=Rn;const ls=new wn(10057557,5601177,.5);ne.add(ls);const q=new at(16777215,.75);{q.position.set(2,3,4),q.castShadow=!0,q.shadow.mapSize=new I(1024,1024).multiplyScalar(4);const h=q.position.length()+se.position.length();q.shadow.camera.far=h+4.5,q.shadow.bias=-.001}se.add(q);cs(h=>{de.textContent=Re.LOADING+` ${h.loaded/xn*100|0}%`},()=>{de.textContent=Re.ERROR},()=>{de.textContent=Re.DECODING}).then(h=>{de.style.display="none";const t=h.scene,n=Array(3).fill(75e-6),e=new fe;e.frustumCulled=!1;const s=new B({color:4473924,metalness:.8}),o=new B({color:4473924,side:dt});t.traverse(i=>{if(!(i instanceof ht))return;const c=i.clone();switch(c.geometry.scale(...n),c.castShadow=!0,c.receiveShadow=!0,c.name){case"floor001":case"floor":c.material=o;break;case"columns":case"metal":c.material=s;break;case"walls":c.material=new B({color:8947848});break;case"doors":c.material=new B({color:13421772});break;case"borders":c.material=new B({color:2236962});break;case"glass":c.material=new B({color:11193582,metalness:.6});break}e.add(c)});const a=t.getObjectByName("floor001").geometry.boundingSphere.center.multiplyScalar(-1);e.children.forEach(i=>void i.position.copy(a)),ne.add(e)});H.setAnimationLoop(()=>{mt.update(),H.render(ne,z)});
